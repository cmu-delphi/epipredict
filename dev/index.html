<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Basic epidemiology forecasting methods • epipredict</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Open_Sans-0.4.10/font.css" rel="stylesheet">
<link href="deps/Source_Serif_Pro-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Basic epidemiology forecasting methods">
<meta name="description" content='A forecasting "framework" for creating epidemiological forecasts from versioned data. The framework is designed to be modular so that different components can exchanged, enabling a large amount of flexibility. Some simple baseline models formed from these components are included.'>
<meta property="og:description" content='A forecasting "framework" for creating epidemiological forecasts from versioned data. The framework is designed to be modular so that different components can exchanged, enabling a large amount of flexibility. Some simple baseline models formed from these components are included.'>
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">epipredict</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/epipredict.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="articles/custom_epiworkflows.html">Epiworkflows</a></li>
<li class="nav-item"><a class="nav-link" href="articles/backtesting.html">Backtesting</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/update.html">Using the add/update/remove/adjust functions</a></li>
    <li><a class="dropdown-item" href="articles/panel-data.html">Using epipredict on non-epidemic panel data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epipredict/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="epipredict">Epipredict<a class="anchor" aria-label="anchor" href="#epipredict"></a>
</h1></div>
<!-- badges: start -->

<p><a href="https://cmu-delphi.github.io/epipredict/"><code>{epipredict}</code></a> is a framework for building transformation and forecasting pipelines for epidemiological and other panel time-series datasets. In addition to tools for building forecasting pipelines, it contains a number of “canned” forecasters meant to run with little modification as an easy way to get started forecasting.</p>
<p>It is designed to work well with <a href="https://cmu-delphi.github.io/epiprocess/" class="external-link"><code>{epiprocess}</code></a>, a utility for time series handling and geographic processing in an epidemiological context. Both of the packages are meant to work well with the panel data provided by <a href="https://cmu-delphi.github.io/epidatr/" class="external-link"><code>{epidatr}</code></a>. Pre-compiled example datasets are also available in <a href="https://cmu-delphi.github.io/epidatasets/" class="external-link"><code>{epidatasets}</code></a>.</p>
<p>If you are looking for detail beyond the package documentation, see our <a href="https://cmu-delphi.github.io/delphi-tooling-book/" class="external-link">forecasting book</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Unless you’re planning on contributing to package development, we suggest using the stable version. To install, run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stable version</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"cmu-delphi/epipredict@main"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dev version</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"cmu-delphi/epipredict@dev"</span><span class="op">)</span></span></code></pre></div>
<p>The documentation for the stable version is at <a href="https://cmu-delphi.github.io/epipredict" class="uri">https://cmu-delphi.github.io/epipredict</a>, while the development version is at <a href="https://cmu-delphi.github.io/epipredict/dev" class="uri">https://cmu-delphi.github.io/epipredict/dev</a>.</p>
</div>
<div class="section level2">
<h2 id="motivating-example">Motivating example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h2>
<details><summary>
Required packages
</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmu-delphi/epipredict/" class="external-link">epipredict</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cmu-delphi.github.io/epidatr/" class="external-link">epidatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmu-delphi/epiprocess" class="external-link">epiprocess</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</details><p>To demonstrate using <a href="https://cmu-delphi.github.io/epipredict/"><code>{epipredict}</code></a> for forecasting, suppose we want to predict COVID-19 deaths per 100k people for each of a subset of states</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">used_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"ma"</span>, <span class="st">"ny"</span>, <span class="st">"tx"</span><span class="op">)</span></span></code></pre></div>
<p>on</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-08-01"</span><span class="op">)</span></span></code></pre></div>
<p>We will be using a subset of <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/jhu-csse.html" class="external-link">Johns Hopkins Center for Systems Science and Engineering deaths data</a>. Below the fold, we pull the dataset from the epidata API and clean it.</p>
<details><summary>
Creating the dataset using <code>{epidatr}</code> and <code>{epiprocess}</code>
</summary><p>This section is intended to demonstrate some of the ubiquitous cleaning operations needed to be able to forecast. A subset of the dataset prepared here is also included ready-to-go in <a href="https://cmu-delphi.github.io/epipredict/"><code>{epipredict}</code></a> as <code>covid_case_death_rates</code>.</p>
<p>First we pull both <code>jhu-csse</code> cases and deaths data from the <a href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast.html" class="external-link">Delphi API</a> using the <a href="https://cmu-delphi.github.io/epidatr/" class="external-link"><code>{epidatr}</code></a> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/pub_covidcast.html" class="external-link">pub_covidcast</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"jhu-csse"</span>,</span>
<span>  signals <span class="op">=</span> <span class="st">"confirmed_7dav_incidence_prop"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  geo_type <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_values <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">20200601</span>, <span class="fl">20211231</span><span class="op">)</span>,</span>
<span>  geo_values <span class="op">=</span> <span class="st">"*"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, case_rate <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/pub_covidcast.html" class="external-link">pub_covidcast</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"jhu-csse"</span>,</span>
<span>  signals <span class="op">=</span> <span class="st">"deaths_7dav_incidence_prop"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  geo_type <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>  time_values <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epidatr/reference/epirange.html" class="external-link">epirange</a></span><span class="op">(</span><span class="fl">20200601</span>, <span class="fl">20211231</span><span class="op">)</span>,</span>
<span>  geo_values <span class="op">=</span> <span class="st">"*"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, death_rate <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span><span class="va">cases_deaths</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">cases</span>, <span class="va">deaths</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"time_value"</span>, <span class="st">"geo_value"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geo_value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">used_locations</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://cmu-delphi.github.io/epiprocess/reference/epi_df.html" class="external-link">as_epi_df</a></span><span class="op">(</span>as_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since visualizing the results on every geography is somewhat overwhelming, we’ll only train on a subset of locations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotting the data as it was downloaded</span></span>
<span><span class="va">cases_deaths</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span></span>
<span>    <span class="va">case_rate</span>,</span>
<span>    <span class="va">death_rate</span>,</span>
<span>    .color_by <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">.response_name</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span>,</span>
<span>    scale <span class="op">=</span> <span class="st">"free"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"3 months"</span>, date_labels <span class="op">=</span> <span class="st">"%Y %b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-date-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>As with the typical dataset, we will need to do some cleaning to make it actually usable; we’ll use some utilities from <a href="https://cmu-delphi.github.io/epiprocess/" class="external-link"><code>{epiprocess}</code></a> for this. Specifically we’ll trim outliers, especially negative values:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cases_deaths</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cases_deaths</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    outlr_death_rate <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epiprocess/reference/detect_outlr.html" class="external-link">detect_outlr_rm</a></span><span class="op">(</span></span>
<span>      <span class="va">time_value</span>, <span class="va">death_rate</span>,</span>
<span>      detect_negatives <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span>,</span>
<span>    outlr_case_rate <span class="op">=</span> <span class="fu"><a href="https://cmu-delphi.github.io/epiprocess/reference/detect_outlr.html" class="external-link">detect_outlr_rm</a></span><span class="op">(</span></span>
<span>      <span class="va">time_value</span>, <span class="va">case_rate</span>,</span>
<span>      detect_negatives <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"outlr"</span><span class="op">)</span>, names_sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    death_rate <span class="op">=</span> <span class="va">outlr_death_rate_replacement</span>,</span>
<span>    case_rate <span class="op">=</span> <span class="va">outlr_case_rate_replacement</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">time_value</span>, <span class="va">case_rate</span>, <span class="va">death_rate</span><span class="op">)</span></span></code></pre></div>
</details><p>After downloading and cleaning deaths per capita, as well as cases per 100k people, we can plot a subset of the states, marking the desired forecast date with a vertical line:</p>
<details><summary>
Plot
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_date_label</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    geo_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">used_locations</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    .response_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"case_rate"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"death_rate"</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">forecast_date</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">used_locations</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">processed_data_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cases_deaths</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">geo_value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">used_locations</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span></span>
<span>    <span class="va">case_rate</span>,</span>
<span>    <span class="va">death_rate</span>,</span>
<span>    .color_by <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span></span>
<span>    rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">.response_name</span><span class="op">)</span>,</span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">geo_value</span><span class="op">)</span>,</span>
<span>    scale <span class="op">=</span> <span class="st">"free"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">forecast_date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecast_date_label</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dates</span>, label <span class="op">=</span> <span class="st">"forecast\ndate"</span>, y <span class="op">=</span> <span class="va">heights</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"3 months"</span>, date_labels <span class="op">=</span> <span class="st">"%Y %b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p><img src="reference/figures/README-show-processed-data-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>To make a forecast, we will use a simple “canned” auto-regressive forecaster to predict the death rate four weeks into the future using lagged<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;lagged by 3 in this context meaning using the value from 3 days ago.&lt;/p&gt;"><sup>1</sup></a> deaths and cases.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">four_week_ahead</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/arx_forecaster.html">arx_forecaster</a></span><span class="op">(</span></span>
<span>  <span class="va">cases_deaths</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">&lt;=</span> <span class="va">forecast_date</span><span class="op">)</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"death_rate"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"case_rate"</span>, <span class="st">"death_rate"</span><span class="op">)</span>,</span>
<span>  args_list <span class="op">=</span> <span class="fu"><a href="reference/arx_args_list.html">arx_args_list</a></span><span class="op">(</span></span>
<span>    lags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    ahead <span class="op">=</span> <span class="fl">4</span> <span class="op">*</span> <span class="fl">7</span>,</span>
<span>    quantile_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">four_week_ahead</span></span>
<span><span class="co">#&gt; ══ A basic forecaster of type ARX Forecaster ════════════════════════════════</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; This forecaster was fit on 2025-05-22 11:56:44.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data was an &lt;epi_df&gt; with:</span></span>
<span><span class="co">#&gt; • Geography: state,</span></span>
<span><span class="co">#&gt; • Time type: day,</span></span>
<span><span class="co">#&gt; • Using data up-to-date as of: 2022-01-01.</span></span>
<span><span class="co">#&gt; • With the last data available on 2021-08-01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Predictions ──────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A total of 4 predictions are available for</span></span>
<span><span class="co">#&gt; • 4 unique geographic regions,</span></span>
<span><span class="co">#&gt; • At forecast date: 2021-08-01,</span></span>
<span><span class="co">#&gt; • For target date: 2021-08-29,</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>In our model setup, we are using as predictors the case rate lagged 0-3 days, one week, and two weeks, and the death rate lagged 0-2 weeks. The result <code>four_week_ahead</code> is both a fitted model object which could be used any time in the future to create different forecasts, and a set of predicted values (and prediction intervals) for each location 28 days after the forecast date.</p>
<p>Plotting the prediction intervals on the true values for our location subset<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Alternatively, you could call &lt;code&gt;autoplot(four_week_ahead, observed_response = cases_deaths)&lt;/code&gt; to get the full collection of forecasts. This is too busy for the space we have for plotting here.&lt;/p&gt;"><sup>2</sup></a>:</p>
<details><summary>
Plot
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epiworkflow</span> <span class="op">&lt;-</span> <span class="va">four_week_ahead</span><span class="op">$</span><span class="va">epi_workflow</span></span>
<span><span class="va">restricted_predictions</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">four_week_ahead</span><span class="op">$</span><span class="va">predictions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>time_value <span class="op">=</span> <span class="va">target_date</span>, value <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.response_name <span class="op">=</span> <span class="st">"death_rate"</span><span class="op">)</span></span>
<span><span class="va">forecast_plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">four_week_ahead</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span>observed_response <span class="op">=</span> <span class="va">cases_deaths</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">forecast_date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">forecast_date_label</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.response_name</span> <span class="op">==</span> <span class="st">"death_rate"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dates</span>, label <span class="op">=</span> <span class="st">"forecast\ndate"</span>, y <span class="op">=</span> <span class="va">heights</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>, hjust <span class="op">=</span> <span class="st">"right"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"3 months"</span>, date_labels <span class="op">=</span> <span class="st">"%y %b"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p><img src="reference/figures/README-show-single-forecast-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>And as a tibble of quantile level-value pairs:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">four_week_ahead</span><span class="op">$</span><span class="va">predictions</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">.pred</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/pivot_quantiles.html">pivot_quantiles_longer</a></span><span class="op">(</span><span class="va">.pred_distn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geo_value</span>, <span class="va">forecast_date</span>, <span class="va">target_date</span>, quantile <span class="op">=</span> <span class="va">.pred_distn_quantile_level</span>, value <span class="op">=</span> <span class="va">.pred_distn_value</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 20 × 5</span></span>
<span><span class="co">#&gt;   geo_value forecast_date target_date quantile  value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;date&gt;        &lt;date&gt;         &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 ca        2021-08-01    2021-08-29      0.1  0.198 </span></span>
<span><span class="co">#&gt; 2 ca        2021-08-01    2021-08-29      0.25 0.285 </span></span>
<span><span class="co">#&gt; 3 ca        2021-08-01    2021-08-29      0.5  0.345 </span></span>
<span><span class="co">#&gt; 4 ca        2021-08-01    2021-08-29      0.75 0.405 </span></span>
<span><span class="co">#&gt; 5 ca        2021-08-01    2021-08-29      0.9  0.491 </span></span>
<span><span class="co">#&gt; 6 ma        2021-08-01    2021-08-29      0.1  0.0277</span></span>
<span><span class="co">#&gt; # ℹ 14 more rows</span></span></code></pre></div>
<p>The orange dot gives the point prediction, while the blue intervals give the 25-75%, the 10-90%, and 2.5-97.5% inter-quantile ranges<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that these are not the same quantiles that we fit when creating &lt;code&gt;four_week_ahead&lt;/code&gt;. They are extrapolated from those quantiles using &lt;code&gt;&lt;a href="reference/extrapolate_quantiles.html"&gt;extrapolate_quantiles()&lt;/a&gt;&lt;/code&gt; (which assumes an exponential decay in the tails).&lt;/p&gt;'><sup>3</sup></a>. For this particular day and these locations, the forecasts are relatively accurate, with the true data being at least within the 10-90% interval. A couple of things to note:</p>
<ol style="list-style-type: decimal">
<li>
<code>epipredict</code> methods are primarily direct forecasters; this means we don’t need to predict 1, 2,…, 27 days ahead to then predict 28 days ahead.</li>
<li>All of our existing engines are geo-pooled, meaning the training data is shared across geographies. This has the advantage of increasing the amount of available training data, with the restriction that the data needs to be on comparable scales, such as rates.</li>
</ol>
</div>
<div class="section level2">
<h2 id="getting-help">Getting Help<a class="anchor" aria-label="anchor" href="#getting-help"></a>
</h2>
<p>If you encounter a bug or have a feature request, feel free to file an <a href="https://github.com/cmu-delphi/epipredict/issues" class="external-link">issue on our GitHub page</a>. For other questions, feel free to reach out to the authors, either via this <a href="https://docs.google.com/forms/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">contact form</a>, email, or the InsightNet Slack.</p>
</div>
</div>


  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/cmu-delphi/epipredict/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/cmu-delphi/epipredict/issues/" class="external-link">Report a bug</a></li>
<li><a href="https://cmu-delphi.github.io/epiprocess/" class="external-link">The epiprocess package</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing epipredict</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Daniel J. McDonald <br><small class="roles"> Author, maintainer </small>   </li>
<li>Ryan Tibshirani <br><small class="roles"> Author </small>   </li>
<li>Dmitry Shemetov <br><small class="roles"> Author </small>   </li>
<li>David Weber <br><small class="roles"> Author </small>   </li>
<li>Delphi Research Group <br><small class="roles"> Copyright holder, funder </small>   </li>
<li>Logan Brooks <br><small class="roles"> Author </small>   </li>
<li>Rachel Lobay <br><small class="roles"> Author </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/cmu-delphi/epipredict/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/cmu-delphi/epipredict/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

<div class="delphi-packages-and-resources">
<h2 data-toc-skip>Delphi packages and resources</h2>
<ul class="list-unstyled">
<li><ul>
<li><a href="https://github.com/cmu-delphi/epidatr/" class="external-link">The epidatr package</a></li>
<li><a href="https://cmu-delphi.github.io/epiprocess/" class="external-link">The epiprocess package</a></li>
<li><a href="https://cmu-delphi.github.io/epidatasets/" class="external-link">The epidatasets package</a></li>
<li><a href="https://cmu-delphi.github.io/delphi-tooling-book/" class="external-link">Introduction to Delphi’s Tooling Work</a></li>
</ul></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epipredict</p>
</div>

    </footer>
</div>





  </body>
</html>
