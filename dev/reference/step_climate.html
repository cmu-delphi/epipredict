<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate a climatological variable based on the history — step_climate • epipredict</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Serif_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate a climatological variable based on the history — step_climate"><meta name="description" content="step_climate() creates a specification of a recipe step that will
generate one or more new columns of derived data. This step examines all
available seasons in the training data and calculates the a measure of center
for the &quot;typical&quot; season. Think of this like with the weather: to predict the
temperature in January in Pittsburgh, PA, I might look at all previous
January's on record, average their temperatures, and include that in my
model. So it is important to align the forecast horizon with the climate.
This step will work best if added after step_epi_ahead(), but that is not
strictly required. See the details for more information."><meta property="og:description" content="step_climate() creates a specification of a recipe step that will
generate one or more new columns of derived data. This step examines all
available seasons in the training data and calculates the a measure of center
for the &quot;typical&quot; season. Think of this like with the weather: to predict the
temperature in January in Pittsburgh, PA, I might look at all previous
January's on record, average their temperatures, and include that in my
model. So it is important to align the forecast horizon with the climate.
This step will work best if added after step_epi_ahead(), but that is not
strictly required. See the details for more information."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epipredict</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epipredict.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/custom_epiworkflows.html">Epiworkflows</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/backtesting.html">Backtesting</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/update.html">Using the add/update/remove/adjust functions</a></li>
    <li><a class="dropdown-item" href="../articles/panel-data.html">Using epipredict on non-epidemic panel data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epipredict/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate a climatological variable based on the history</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epipredict/blob/dev/R/step_climate.R" class="external-link"><code>R/step_climate.R</code></a></small>
      <div class="d-none name"><code>step_climate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>step_climate()</code> creates a <em>specification</em> of a recipe step that will
generate one or more new columns of derived data. This step examines all
available seasons in the training data and calculates the a measure of center
for the "typical" season. Think of this like with the weather: to predict the
temperature in January in Pittsburgh, PA, I might look at all previous
January's on record, average their temperatures, and include that in my
model. So it is important to <em>align</em> the forecast horizon with the climate.
This step will work best if added after <code><a href="step_epi_shift.html">step_epi_ahead()</a></code>, but that is not
strictly required. See the details for more information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">step_climate</span><span class="op">(</span></span>
<span>  <span class="va">recipe</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  forecast_ahead <span class="op">=</span> <span class="st">"detect"</span>,</span>
<span>  role <span class="op">=</span> <span class="st">"predictor"</span>,</span>
<span>  time_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"detect"</span>, <span class="st">"epiweek"</span>, <span class="st">"week"</span>, <span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span>,</span>
<span>  center_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"mean"</span><span class="op">)</span>,</span>
<span>  window_size <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  epi_keys <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"climate_"</span>,</span>
<span>  skip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/rand_id.html" class="external-link">rand_id</a></span><span class="op">(</span><span class="st">"climate"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-recipe">recipe<a class="anchor" aria-label="anchor" href="#arg-recipe"></a></dt>
<dd><p>A recipe object. The step will be added to the
sequence of operations for this recipe.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>One or more selector functions to choose variables
for this step. See <code><a href="https://recipes.tidymodels.org/reference/selections.html" class="external-link">recipes::selections()</a></code> for more details.</p></dd>


<dt id="arg-forecast-ahead">forecast_ahead<a class="anchor" aria-label="anchor" href="#arg-forecast-ahead"></a></dt>
<dd><p>The forecast horizon. By default, this step will try to
detect whether a forecast horizon has already been specified with
<code><a href="step_epi_shift.html">step_epi_ahead()</a></code>. Alternatively, one can specify an explicit
horizon with a scalar integer. Auto-detection is only possible
when the time type of the <code>epi_df</code> used to create the <code>epi_recipe</code> is the
same as the aggregation
<code>time_type</code> specified in this step (say, both daily or both weekly). If,
for example, daily data is used with monthly time aggregation, then
auto-detection is not possible (and may in fact lead to strange behaviour
even if <code>forecast_ahead</code> is specified with an integer). See details below.</p></dd>


<dt id="arg-role">role<a class="anchor" aria-label="anchor" href="#arg-role"></a></dt>
<dd><p>What role should be assigned for any variables created by this
step? "predictor" is the most likely choice.</p></dd>


<dt id="arg-time-type">time_type<a class="anchor" aria-label="anchor" href="#arg-time-type"></a></dt>
<dd><p>The duration over which time aggregation should be performed.</p></dd>


<dt id="arg-center-method">center_method<a class="anchor" aria-label="anchor" href="#arg-center-method"></a></dt>
<dd><p>The measure of center to be calculated over the time
window.</p></dd>


<dt id="arg-window-size">window_size<a class="anchor" aria-label="anchor" href="#arg-window-size"></a></dt>
<dd><p>Scalar integer. How many time units on each side should
be included. For example, if <code>window_size = 3</code> and <code>time_type = "day"</code>,
then on each day in the data, the center will be calculated using 3 days
before and three days after. So, in this case, it operates like a weekly
rolling average, centered at each day.</p></dd>


<dt id="arg-epi-keys">epi_keys<a class="anchor" aria-label="anchor" href="#arg-epi-keys"></a></dt>
<dd><p>Character vector or <code>NULL</code>. Any columns mentioned will be
grouped before performing any center calculation. So for example, given
state-level data, a national climate would be calculated if <code>NULL</code>, but
passing <code>epi_keys = "geo_value"</code> would calculate the climate separately
by state.</p></dd>


<dt id="arg-prefix">prefix<a class="anchor" aria-label="anchor" href="#arg-prefix"></a></dt>
<dd><p>A character string that will be prefixed to the new column.</p></dd>


<dt id="arg-skip">skip<a class="anchor" aria-label="anchor" href="#arg-skip"></a></dt>
<dd><p>A logical. Should the step be skipped when the
recipe is baked by <code><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake()</a></code>? While all operations are baked
when <code><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep()</a></code> is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using <code>skip = TRUE</code> as it may affect
the computations for subsequent operations.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>A unique identifier for the step</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated version of <code>recipe</code> with the new step added to the
sequence of any existing operations.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Construction of a climate predictor can be helpful with strongly seasonal
data. But its utility is greatest when the estimated "climate" is aligned
to the forecast horizon.
For example, if today is December 1, and we want
to make a prediction for December 15, we want to know the climate for the
week of December 15 to use in our model. But we also want to align the rest
of our training data with the climate <em>2 weeks after</em> those dates.</p>
<p>To accomplish
this, if we have daily data, we could use <code>time_type = "week"</code> and
<code>forecast_ahead = 2</code>. The climate predictor would be created by taking
averages over each week (with a window of a few weeks before and after, as
determined by <code>window_size</code>), and then aligning these with the appropriate dates
in the training data so that each <code>time_value</code> will "see" the typical climate 2
weeks in the future.</p>
<p>Alternatively, in the same scenario, we could use <code>time_type = "day"</code> and
<code>forecast_ahead = 14</code>. The climate predictor would be created by taking
averages over a small window around each <em>day</em>, and then aligning these with
the appropriate dates in the training data so that each <code>time_value</code> will
"see" the climate 14 days in the future.</p>
<p>The only differences between these options is the type of averaging performed
over the historical data. In the first case, days in the same week will get
the same value of the climate predictor (because we're looking at weekly
windows), while in the second case, every day in the data will have the
average climate for the <em>day</em> that happens 14 days in the future.</p>
<p>Autodetecting the forecast horizon can only be guaranteed to work correctly
when the time types are the same: for example using daily data for training
and daily climate calculations. However, using weekly data, predicting 4
weeks ahead, and setting <code>time_type = "month"</code> is perfectly reasonable. It's
just that the climate is calculated over <em>months</em> (January, February, March,
etc.) so how to properly align this when producing a forecast for the 5th week
in the year is challenging. For scenarios like these, it may be best to
approximately match the times with <code>forecast_ahead = 1</code>, for example.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># automatically detects the horizon</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="epi_recipe.html">epi_recipe</a></span><span class="op">(</span><span class="va">covid_case_death_rates</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_epi_shift.html">step_epi_ahead</a></span><span class="op">(</span><span class="va">death_rate</span>, ahead <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">step_climate</span><span class="op">(</span><span class="va">death_rate</span>, time_type <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Inputs </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of variables by role</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> raw:        2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> geo_value:  1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> time_value: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Operations </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">7</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2. Calculating climate_predictor for: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">day using the median</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">covid_case_death_rates</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `epi_df` object, 20,888 x 6 with metadata:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * geo_type  = state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * time_type = day</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * as_of     = 2023-03-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 20,888 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    geo_value time_value case_rate death_rate ahead_7_death_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> ak        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> al        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.438</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> ar        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              1.27 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> as        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> az        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              1.10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> ca        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.755</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> co        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.376</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> ct        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.819</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> dc        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> de        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.912</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 20,878 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: climate_death_rate &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># same idea, but using weekly climate</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="epi_recipe.html">epi_recipe</a></span><span class="op">(</span><span class="va">covid_case_death_rates</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_epi_shift.html">step_epi_ahead</a></span><span class="op">(</span><span class="va">death_rate</span>, ahead <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">step_climate</span><span class="op">(</span><span class="va">death_rate</span>,</span></span>
<span class="r-in"><span>    forecast_ahead <span class="op">=</span> <span class="fl">1</span>, time_type <span class="op">=</span> <span class="st">"epiweek"</span>,</span></span>
<span class="r-in"><span>    window_size <span class="op">=</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Inputs </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of variables by role</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> raw:        2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> geo_value:  1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> time_value: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Operations </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">7</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2. Calculating climate_predictor for: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">epiweek using the median</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">covid_case_death_rates</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `epi_df` object, 20,888 x 6 with metadata:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * geo_type  = state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * time_type = day</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * as_of     = 2023-03-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 20,888 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    geo_value time_value case_rate death_rate ahead_7_death_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> ak        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> al        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.438</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> ar        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              1.27 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> as        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> az        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              1.10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> ca        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.755</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> co        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.376</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> ct        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.819</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> dc        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> de        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>              0.912</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 20,878 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: climate_death_rate &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># switching the order is possible if you specify `forecast_ahead`</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="epi_recipe.html">epi_recipe</a></span><span class="op">(</span><span class="va">covid_case_death_rates</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">step_climate</span><span class="op">(</span><span class="va">death_rate</span>, forecast_ahead <span class="op">=</span> <span class="fl">7</span>, time_type <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="step_epi_shift.html">step_epi_ahead</a></span><span class="op">(</span><span class="va">death_rate</span>, ahead <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Inputs </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of variables by role</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> raw:        2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> geo_value:  1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> time_value: 1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Operations </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1. Calculating climate_predictor for: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">day using the median</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 2. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">7</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="va">covid_case_death_rates</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `epi_df` object, 20,888 x 6 with metadata:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * geo_type  = state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * time_type = day</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * as_of     = 2023-03-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 20,888 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    geo_value time_value case_rate death_rate climate_death_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> ak        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> al        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> ar        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> as        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> az        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> ca        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> co        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> ct        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> dc        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> de        2020-12-24        <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>                 <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 20,878 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: ahead_7_death_rate &lt;dbl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epipredict</p>
</div>

    </footer></div>





  </body></html>

