<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Direct autoregressive classifier with covariates — arx_classifier • epipredict</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Serif_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Direct autoregressive classifier with covariates — arx_classifier"><meta name="description" content='This is an autoregressive classification model for continuous data. It does
"direct" forecasting, meaning that it estimates a class at a particular
target horizon.'><meta property="og:description" content='This is an autoregressive classification model for continuous data. It does
"direct" forecasting, meaning that it estimates a class at a particular
target horizon.'><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epipredict</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/epipredict.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/custom_epiworkflows.html">Epiworkflows</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/backtesting.html">Backtesting</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/update.html">Using the add/update/remove/adjust functions</a></li>
    <li><a class="dropdown-item" href="../articles/panel-data.html">Using epipredict on non-epidemic panel data</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epipredict/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Direct autoregressive classifier with covariates</h1>
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epipredict/blob/dev/R/arx_classifier.R" class="external-link"><code>R/arx_classifier.R</code></a></small>
      <div class="d-none name"><code>arx_classifier.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is an autoregressive classification model for continuous data. It does
"direct" forecasting, meaning that it estimates a class at a particular
target horizon.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">arx_classifier</span><span class="op">(</span></span>
<span>  <span class="va">epi_data</span>,</span>
<span>  <span class="va">outcome</span>,</span>
<span>  <span class="va">predictors</span>,</span>
<span>  trainer <span class="op">=</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html" class="external-link">logistic_reg</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  args_list <span class="op">=</span> <span class="fu"><a href="arx_class_args_list.html">arx_class_args_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-epi-data">epi_data<a class="anchor" aria-label="anchor" href="#arg-epi-data"></a></dt>
<dd><p>An <code>epi_df</code> object</p></dd>


<dt id="arg-outcome">outcome<a class="anchor" aria-label="anchor" href="#arg-outcome"></a></dt>
<dd><p>A character (scalar) specifying the outcome (in the
<code>epi_df</code>). Note that as with <code><a href="arx_forecaster.html">arx_forecaster()</a></code>, this is expected to
be real-valued. Conversion of this data to unordered classes is handled
internally based on the <code>breaks</code> argument to <code><a href="arx_class_args_list.html">arx_class_args_list()</a></code>.
If discrete classes are already in the <code>epi_df</code>, it is recommended to
code up a classifier from scratch using <code><a href="epi_recipe.html">epi_recipe()</a></code>.</p></dd>


<dt id="arg-predictors">predictors<a class="anchor" aria-label="anchor" href="#arg-predictors"></a></dt>
<dd><p>A character vector giving column(s) of predictor variables.
This defaults to the <code>outcome</code>. However, if manually specified, only those
variables specifically mentioned will be used, and the <code>outcome</code> will not be
added.</p></dd>


<dt id="arg-trainer">trainer<a class="anchor" aria-label="anchor" href="#arg-trainer"></a></dt>
<dd><p>A <code>{parsnip}</code> model describing the type of estimation.
For now, we enforce <code>mode = "classification"</code>. Typical values are
<code><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html" class="external-link">parsnip::logistic_reg()</a></code> or <code><a href="https://parsnip.tidymodels.org/reference/multinom_reg.html" class="external-link">parsnip::multinom_reg()</a></code>. More complicated
trainers like <code><a href="https://parsnip.tidymodels.org/reference/naive_Bayes.html" class="external-link">parsnip::naive_Bayes()</a></code> or <code><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">parsnip::rand_forest()</a></code> can
also be used.</p></dd>


<dt id="arg-args-list">args_list<a class="anchor" aria-label="anchor" href="#arg-args-list"></a></dt>
<dd><p>A list of customization arguments to determine
the type of forecasting model. See <code><a href="arx_class_args_list.html">arx_class_args_list()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with (1) <code>predictions</code> an <code>epi_df</code> of predicted classes
and (2) <code>epi_workflow</code>, a list that encapsulates the entire estimation
workflow</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>arx_classifier()</code> is an autoregressive classification model for <code>epi_df</code>
data that is used to predict a discrete class for each case under
consideration.  It is a direct forecaster in that it estimates the classes
at a specific horizon or ahead value.</p>
<p>To get a sense of how the <code>arx_classifier()</code> works, let's consider a simple
example with minimal inputs. For this, we will use the built-in
<code>covid_case_death_rates</code> that contains confirmed COVID-19 cases and deaths
from JHU CSSE for all states over Dec 31, 2020 to Dec 31, 2021. From this,
we'll take a subset of data for five states over June 4, 2021 to December
31, 2021. Our objective is to predict whether the case rates are increasing
when considering the 0, 7 and 14 day case rates:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">jhu</span> <span class="op">&lt;-</span> <span class="va">covid_case_death_rates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">time_value</span> <span class="op">&gt;=</span> <span class="st">"2021-06-04"</span>,</span>
<span>    <span class="va">time_value</span> <span class="op">&lt;=</span> <span class="st">"2021-12-31"</span>,</span>
<span>    <span class="va">geo_value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ca"</span>, <span class="st">"fl"</span>, <span class="st">"tx"</span>, <span class="st">"ny"</span>, <span class="st">"nj"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arx_classifier.html">arx_classifier</a></span><span class="op">(</span><span class="va">jhu</span>, outcome <span class="op">=</span> <span class="st">"case_rate"</span>, predictors <span class="op">=</span> <span class="st">"case_rate"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span><span class="op">$</span><span class="va">predictions</span></span>
<span><span class="co">#&gt; # A tibble: 5 x 4</span></span>
<span><span class="co">#&gt;   geo_value .pred_class forecast_date target_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;fct&gt;       &lt;date&gt;        &lt;date&gt;</span></span>
<span><span class="co">#&gt; 1 ca        (-Inf,0.25] 2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 2 fl        (-Inf,0.25] 2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 3 nj        (-Inf,0.25] 2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 4 ny        (-Inf,0.25] 2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 5 tx        (-Inf,0.25] 2021-12-31    2022-01-07</span></span></code></pre><p></p></div>
<p>The key takeaway from the predictions is that there are two prediction
classes: <code>(-Inf, 0.25]</code> and <code>(0.25, Inf)</code>: the classes to predict must be
discrete. The discretization of the real-valued outcome is controlled by
the <code>breaks</code> argument, which defaults to <code>0.25</code>. Such breaks will be
automatically extended to cover the entire real line. For example, the
default break of <code>0.25</code> is silently extended to <code>breaks = c(-Inf, .25, Inf)</code> and, therefore, results in two classes: <code>[-Inf, 0.25]</code> and <code>(0.25, Inf)</code>. These two classes are used to discretize the outcome. The conversion
of the outcome to such classes is handled internally. So if discrete
classes already exist for the outcome in the <code>epi_df</code>, then we recommend to
code a classifier from scratch using the <code>epi_workflow</code> framework for more
control.</p>
<p>The <code>trainer</code> is a <code>parsnip</code> model describing the type of estimation such
that <code>mode = "classification"</code> is enforced. The two typical trainers that
are used are <code><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html" class="external-link">parsnip::logistic_reg()</a></code> for two classes or
<code><a href="https://parsnip.tidymodels.org/reference/multinom_reg.html" class="external-link">parsnip::multinom_reg()</a></code> for more than two classes.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_spec_parsnip</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">epi_workflow</span><span class="op">)</span></span>
<span><span class="co">#&gt; Logistic Regression Model Specification (classification)</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Computational engine: glm</span></span></code></pre><p></p></div>
<p>From the parsnip model specification, we can see that the trainer used is
logistic regression, which is expected for our binary outcome. More
complicated trainers like <code><a href="https://parsnip.tidymodels.org/reference/naive_Bayes.html" class="external-link">parsnip::naive_Bayes()</a></code> or
<code><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">parsnip::rand_forest()</a></code> may also be used (however, we will stick to the
basics in this gentle introduction to the classifier).</p>
<p>If you use the default trainer of logistic regression for binary
classification and you decide against using the default break of 0.25, then
you should only input one break so that there are two classification bins
to properly dichotomize the outcome. For example, let's set a break of 0.5
instead of relying on the default of 0.25. We can do this by passing 0.5 to
the <code>breaks</code> argument in <code><a href="arx_class_args_list.html">arx_class_args_list()</a></code> as follows:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">out_break_0.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/arx_classifier.html">arx_classifier</a></span><span class="op">(</span></span>
<span>  <span class="va">jhu</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"case_rate"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="st">"case_rate"</span>,</span>
<span>  args_list <span class="op">=</span> <span class="fu"><a href="../reference/arx_class_args_list.html">arx_class_args_list</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: glm.fit: algorithm did not converge</span></span>
<span><span class="co">#&gt; Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</span></span>
<span></span>
<span><span class="va">out_break_0.5</span><span class="op">$</span><span class="va">predictions</span></span>
<span><span class="co">#&gt; # A tibble: 5 x 4</span></span>
<span><span class="co">#&gt;   geo_value .pred_class forecast_date target_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;fct&gt;       &lt;date&gt;        &lt;date&gt;</span></span>
<span><span class="co">#&gt; 1 ca        (-Inf,0.5]  2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 2 fl        (-Inf,0.5]  2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 3 nj        (-Inf,0.5]  2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 4 ny        (-Inf,0.5]  2021-12-31    2022-01-07</span></span>
<span><span class="co">#&gt; 5 tx        (-Inf,0.5]  2021-12-31    2022-01-07</span></span></code></pre><p></p></div>
<p>Indeed, we can observe that the two <code>.pred_class</code> are now (-Inf, 0.5] and
(0.5, Inf). See <code><a href="arx_class_args_list.html">help(arx_class_args_list)</a></code> for other available
modifications.</p>
<p>Additional arguments that may be supplied to <code><a href="arx_class_args_list.html">arx_class_args_list()</a></code> include
the expected <code>lags</code> and <code>ahead</code> arguments for an autoregressive-type model.
These have default values of 0, 7, and 14 days for the lags of the
predictors and 7 days ahead of the forecast date for predicting the
outcome. There is also <code>n_training</code> to indicate the upper bound for the
number of training rows per key. If you would like some practice with using
this, then remove the filtering command to obtain data within "2021-06-04"
and "2021-12-31" and instead set <code>n_training</code> to be the number of days
between these two dates, inclusive of the end points. The end results
should be the same. In addition to <code>n_training</code>, there are <code>forecast_date</code>
and <code>target_date</code> to specify the date that the forecast is created and
intended, respectively. We will not dwell on such arguments here as they
are not unique to this classifier or absolutely essential to understanding
how it operates. The remaining arguments will be discussed organically, as
they are needed to serve our purposes. For information on any remaining
arguments that are not discussed here, please see the function
documentation for a complete list and their definitions.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="arx_class_epi_workflow.html">arx_class_epi_workflow()</a></code>, <code><a href="arx_class_args_list.html">arx_class_args_list()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">tiny_geos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"as"</span>, <span class="st">"mp"</span>, <span class="st">"vi"</span>, <span class="st">"gu"</span>, <span class="st">"pr"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">jhu</span> <span class="op">&lt;-</span> <span class="va">covid_case_death_rates</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-11-01"</span><span class="op">)</span>, <span class="op">!</span><span class="op">(</span><span class="va">geo_value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">tiny_geos</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">arx_classifier</span><span class="op">(</span><span class="va">jhu</span>, <span class="st">"death_rate"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"case_rate"</span>, <span class="st">"death_rate"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">arx_classifier</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">jhu</span>,</span></span>
<span class="r-in"><span>  <span class="st">"death_rate"</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"case_rate"</span>, <span class="st">"death_rate"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  trainer <span class="op">=</span> <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/multinom_reg.html" class="external-link">multinom_reg</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  args_list <span class="op">=</span> <span class="fu"><a href="arx_class_args_list.html">arx_class_args_list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>, <span class="fl">.1</span><span class="op">)</span>, ahead <span class="op">=</span> <span class="fl">14</span>,</span></span>
<span class="r-in"><span>    horizon <span class="op">=</span> <span class="fl">14</span>, method <span class="op">=</span> <span class="st">"linear_reg"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epipredict</p>
</div>

    </footer></div>





  </body></html>

