<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using the add/update/remove and adjust functions • epipredict</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Open_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Serif_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using the add/update/remove and adjust functions">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epipredict</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/epipredict.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/preprocessing-and-models.html">Examples of Preprocessing and Models</a></li>
    <li><a class="dropdown-item" href="../articles/backtesting.html">Accurately backtesting forecasters</a></li>
    <li><a class="dropdown-item" href="../articles/arx-classifier.html">Auto-regressive classifier</a></li>
    <li><a class="dropdown-item" href="../articles/update.html">Using the add/update/remove and adjust functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cmu-delphi/epipredict/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using the add/update/remove and adjust functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cmu-delphi/epipredict/blob/dev/vignettes/update.Rmd" class="external-link"><code>vignettes/update.Rmd</code></a></small>
      <div class="d-none name"><code>update.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cmu-delphi/epipredict/" class="external-link">epipredict</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette, we will state the main goal of the
add/update/remove and adjust functions and describe what part of the
processing each function is intended for. We will then demonstrate how
to use the sets of add/update/remove functions, followed by the adjust
functions, and end with a brief discussion on the tidy methods for
recipe and frosting objects.</p>
<div class="section level2">
<h2 id="main-goal-of-the-addupdateremove-and-adjust-functions">Main goal of the add/update/remove and adjust functions<a class="anchor" aria-label="anchor" href="#main-goal-of-the-addupdateremove-and-adjust-functions"></a>
</h2>
<p>The primary goal of the update and adjust functions is to allow the
user to modify a <code>step</code>, <code>layer</code>,
<code>epi_recipe</code>, <code>frosting</code>, or a part of an
<code>epi_workflow</code> so that they do not have to create a new
object each time they wish to make a change to the pre-processing,
fitting, or post-processing.</p>
<p>In the context of pre-processing, the goal of the update functions is
to add/remove/update an <code>epi_recipe</code> or a step in it. For
this, we have <code><a href="../reference/add_epi_recipe.html">add_epi_recipe()</a></code>,
<code><a href="../reference/add_epi_recipe.html">update_epi_recipe()</a></code>, and <code><a href="../reference/add_epi_recipe.html">remove_epi_recipe()</a></code>
to add/update/remove an entire <code>epi_recipe</code> in an
<code>epi_workflow</code> as well as <code><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe()</a></code> to
adjust a particular step in an <code>epi_recipe</code> or
<code>epi_workflow</code> by the step number or name. For a model, one
may <code><a href="../reference/Add_model.html">Add_model()</a></code>, <code><a href="../reference/Add_model.html">Update_model()</a></code>, or
<code><a href="../reference/Add_model.html">Remove_model()</a></code> in an <code>epi_workflow</code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;We capitalize these names to avoid possible clashes with
the &lt;a href="https://github.com/tidymodels/workflows" class="external-link"&gt;workflows&lt;/a&gt; versions of these functions. The lower-case
versions are also available, however, if you load
&lt;a href="https://github.com/tidymodels/workflows" class="external-link"&gt;workflows&lt;/a&gt; after &lt;a href="https://github.com/cmu-delphi/epipredict/" class="external-link"&gt;epipredict&lt;/a&gt;, these will be
masked and may not work as expected.&lt;/p&gt;'><sup>1</sup></a> For
post-processing, where the goal is to update a frosting object or a
layer in it, we have <code><a href="../reference/add_frosting.html">add_frosting()</a></code>,
<code><a href="../reference/add_frosting.html">remove_frosting()</a></code>, and <code><a href="../reference/add_frosting.html">update_frosting()</a></code> to
add/update/remove an entire <code>frosting</code> object in an
<code>epi_workflow</code> as well as <code><a href="../reference/adjust_frosting.html">adjust_frosting()</a></code> to
adjust a particular layer in a <code>frosting</code> or
<code>epi_workflow</code> by its number or name. A summary of the
function uses by processing step is shown by the following table:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="55%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Add/update/remove functions</th>
<th>adjust functions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Pre-processing</td>
<td>
<code><a href="../reference/add_epi_recipe.html">add_epi_recipe()</a></code>, <code><a href="../reference/add_epi_recipe.html">update_epi_recipe()</a></code>,
<code><a href="../reference/add_epi_recipe.html">remove_epi_recipe()</a></code>
</td>
<td><code><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe()</a></code></td>
</tr>
<tr class="even">
<td>Model specification</td>
<td>
<code><a href="../reference/Add_model.html">Add_model()</a></code>, <code><a href="../reference/Add_model.html">Update_model()</a></code>
<code><a href="../reference/Add_model.html">Remove_model()</a></code>
</td>
<td></td>
</tr>
<tr class="odd">
<td>Post-processing</td>
<td>
<code><a href="../reference/add_frosting.html">add_frosting()</a></code>, <code><a href="../reference/add_frosting.html">remove_frosting()</a></code>,
<code><a href="../reference/add_frosting.html">update_frosting()</a></code>
</td>
<td><code><a href="../reference/adjust_frosting.html">adjust_frosting()</a></code></td>
</tr>
</tbody>
</table>
<p>Since adding/removing/updating frosting as well as adjusting a layer
in a <code>frosting</code> object proceeds in the same way as performing
those tasks on an <code>epi_recipe</code>, we will focus on implementing
those for an <code>epi_recipe</code> in this vignette and only briefly
go through some examples for a <code>frosting</code> object.</p>
</div>
<div class="section level2">
<h2 id="addupdateremove-an-epi_recipe-in-an-epi_workflow">Add/update/remove an <code>epi_recipe</code> in an
<code>epi_workflow</code><a class="anchor" aria-label="anchor" href="#addupdateremove-an-epi_recipe-in-an-epi_workflow"></a>
</h2>
<p>We start with the built-in <code>covid_case_death_rates</code>
dataset that contains JHU daily COVID-19 cases and deaths by state and
take a subset of it from Nov. 1, 2021 to Dec. 31, 2021 for the four
states of Alaska, California, New York, and South Carolina.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jhu</span> <span class="op">&lt;-</span> <span class="va">covid_case_death_rates</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time_value</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-11-01"</span><span class="op">)</span>, <span class="va">geo_value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ak"</span>, <span class="st">"ca"</span>, <span class="st">"ny"</span>, <span class="st">"sc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jhu</span></span>
<span><span class="co">#&gt; An `epi_df` object, 244 x 4 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2023-03-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 244 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span> <span style="font-weight: bold;">case_rate</span> <span style="font-weight: bold;">death_rate</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ak        2021-11-01      87.9      0.494</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2021-11-01      15.6      0.241</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ny        2021-11-01      19.9      0.177</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sc        2021-11-01      16.0      0.531</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ak        2021-11-02      83.2      0.395</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ca        2021-11-02      15.4      0.200</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 238 more rows</span></span></span></code></pre></div>
<p>Then, we construct a simple <code>epi_recipe</code> object named
<code>r</code>, where we lag the death rates by 0, 7, and 14 days, lead
the death rate by 14 days, omit NA values in all predictors and then in
all outcomes (and set <code>skip = TRUE</code> to skip over this
processing of the outcome variable when the recipe is baked).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epi_recipe.html">epi_recipe</a></span><span class="op">(</span><span class="va">jhu</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_epi_shift.html">step_epi_lag</a></span><span class="op">(</span><span class="va">death_rate</span>, lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_epi_shift.html">step_epi_ahead</a></span><span class="op">(</span><span class="va">death_rate</span>, ahead <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_naomit.html" class="external-link">step_naomit</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_naomit.html" class="external-link">step_naomit</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_outcomes</a></span><span class="op">(</span><span class="op">)</span>, skip <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We add this recipe to an <code>epi_workflow</code> object by
inputting <code>r</code> into the <code><a href="../reference/add_epi_recipe.html">add_epi_recipe()</a></code>
function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epi_workflow.html">epi_workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_epi_recipe.html">add_epi_recipe</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ Epi Workflow ═════════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> None</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Postprocessor:</span> None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 4 Recipe steps.</span></span>
<span><span class="co">#&gt; 1. step_epi_lag()</span></span>
<span><span class="co">#&gt; 2. step_epi_ahead()</span></span>
<span><span class="co">#&gt; 3. step_naomit()</span></span>
<span><span class="co">#&gt; 4. step_naomit()</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>We may then go on to add the fitted linear model to our
<code>epi_workflow</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit a linear model</span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epi_workflow.html">epi_workflow</a></span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">jhu</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ Epi Workflow [trained] ═══════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Postprocessor:</span> None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 4 Recipe steps.</span></span>
<span><span class="co">#&gt; 1. step_epi_lag()</span></span>
<span><span class="co">#&gt; 2. step_epi_ahead()</span></span>
<span><span class="co">#&gt; 3. step_naomit()</span></span>
<span><span class="co">#&gt; 4. step_naomit()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       (Intercept)   lag_0_death_rate   lag_7_death_rate  lag_14_death_rate  </span></span>
<span><span class="co">#&gt;           0.43314           -0.75303            0.02903            0.09068</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>At this stage, suppose we decide to overhaul our recipe so that we
have a different set of pre-processing steps or we want to make multiple
changes to existing steps, but we desire to keep the remainder of the
<code>epi_workflow</code> the same. We can use the
<code><a href="../reference/add_epi_recipe.html">update_epi_recipe()</a></code> function to trade our current recipe
<code>r</code> for another recipe <code>r2</code> in <code>wf</code> as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/epi_recipe.html">epi_recipe</a></span><span class="op">(</span><span class="va">jhu</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_epi_shift.html">step_epi_lag</a></span><span class="op">(</span><span class="va">death_rate</span>, lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_epi_shift.html">step_epi_lag</a></span><span class="op">(</span><span class="va">case_rate</span>, lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_epi_shift.html">step_epi_ahead</a></span><span class="op">(</span><span class="va">death_rate</span>, ahead <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/step_epi_naomit.html">step_epi_naomit</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_epi_recipe.html">update_epi_recipe</a></span><span class="op">(</span><span class="va">wf</span>, <span class="va">r2</span><span class="op">)</span></span>
<span><span class="va">wf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ Epi Workflow ═════════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Postprocessor:</span> None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5 Recipe steps.</span></span>
<span><span class="co">#&gt; 1. step_epi_lag()</span></span>
<span><span class="co">#&gt; 2. step_epi_lag()</span></span>
<span><span class="co">#&gt; 3. step_epi_ahead()</span></span>
<span><span class="co">#&gt; 4. step_naomit()</span></span>
<span><span class="co">#&gt; 5. step_naomit()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       (Intercept)   lag_0_death_rate   lag_7_death_rate  lag_14_death_rate  </span></span>
<span><span class="co">#&gt;           0.43314           -0.75303            0.02903            0.09068</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>You can see that the output of <code>wf</code> depicts the sequence
of steps in <code>r2</code> instead of <code>r</code>, which indicates
that the update was successful.</p>
<p>A longer approach to achieve the same end is to use
<code><a href="../reference/add_epi_recipe.html">remove_epi_recipe()</a></code> to remove the old recipe and then
<code><a href="../reference/add_epi_recipe.html">add_epi_recipe()</a></code> to add the new one. Under the hood, the
<code><a href="../reference/add_epi_recipe.html">update_epi_recipe()</a></code> function operates in this way.</p>
<p>The <code><a href="../reference/add_epi_recipe.html">add_epi_recipe()</a></code> and
<code><a href="../reference/add_epi_recipe.html">remove_epi_recipe()</a></code> functions offload to the
<a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a> versions of the functions as much as possible.
The main reason for using the <a href="https://github.com/cmu-delphi/epipredict/" class="external-link">epipredict</a> version is so
that we ensure that we retain the <code>epi_workflow</code> class.</p>
<p>To see this, let’s look at what happens if we remove our current
<code>epi_recipe</code> using <code><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">workflows::remove_recipe()</a></code>
and then inspect the class of <code>wf</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># class before</span></span>
<span><span class="co">#&gt; [1] "epi_workflow" "workflow"</span></span>
<span><span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">remove_recipe</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># class after removing recipe using workflows function</span></span>
<span><span class="co">#&gt; [1] "workflow"</span></span></code></pre></div>
<p>We can observe that <code>wf</code> is no longer an
<code>epi_workflow</code> and a <code>workflow</code>. It has been
demoted to only a <code>workflow</code>. While all
<code>epi_workflow</code>s are <code>workflow</code>s, not all
<code>workflow</code>s are <code>epi_workflow</code>s, meaning that
there may be compatibility issues and limitations to the tools that may
be used from the <a href="https://github.com/cmu-delphi/epipredict/" class="external-link">epipredict</a> package on a plain
<code>workflow</code> object.</p>
<p>Now, while we checked what happens to the above
<code>epi_recipe</code> if we remove it, note that we did not actually
store that change to <code>wf</code>. Hence, our
<code>epi_workflow</code> remains unchanged.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ Epi Workflow ═════════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Postprocessor:</span> None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5 Recipe steps.</span></span>
<span><span class="co">#&gt; 1. step_epi_lag()</span></span>
<span><span class="co">#&gt; 2. step_epi_lag()</span></span>
<span><span class="co">#&gt; 3. step_epi_ahead()</span></span>
<span><span class="co">#&gt; 4. step_naomit()</span></span>
<span><span class="co">#&gt; 5. step_naomit()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       (Intercept)   lag_0_death_rate   lag_7_death_rate  lag_14_death_rate  </span></span>
<span><span class="co">#&gt;           0.43314           -0.75303            0.02903            0.09068</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>One thing to notice about this workflow output is that is that the
model fit remains the same as when we had <code>r</code> as the recipe.
This illustrates an important point - Any operations performed using the
old recipe are not updated automatically. So we should be careful to fit
the model using the new recipe, <code>r2</code>. Similarly, if
predictions were made using the old recipe, then they should be
re-generated using the version <code>epi_workflow</code> that contains
the updated recipe. We can use <code><a href="../reference/Add_model.html">Update_model()</a></code> to replace
the model used in <code>wf</code>, and then fit as before:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit linear model</span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Add_model.html">Update_model</a></span><span class="op">(</span><span class="va">wf</span>, <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">jhu</span><span class="op">)</span></span>
<span><span class="va">wf</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ Epi Workflow [trained] ═══════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Postprocessor:</span> None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5 Recipe steps.</span></span>
<span><span class="co">#&gt; 1. step_epi_lag()</span></span>
<span><span class="co">#&gt; 2. step_epi_lag()</span></span>
<span><span class="co">#&gt; 3. step_epi_ahead()</span></span>
<span><span class="co">#&gt; 4. step_naomit()</span></span>
<span><span class="co">#&gt; 5. step_naomit()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       (Intercept)   lag_0_death_rate   lag_1_death_rate   lag_7_death_rate  </span></span>
<span><span class="co">#&gt;          0.290875          -0.156658           0.054776          -0.348165  </span></span>
<span><span class="co">#&gt; lag_14_death_rate    lag_0_case_rate    lag_1_case_rate    lag_2_case_rate  </span></span>
<span><span class="co">#&gt;         -0.303906           0.009033          -0.009466          -0.005362  </span></span>
<span><span class="co">#&gt;   lag_3_case_rate    lag_4_case_rate    lag_5_case_rate    lag_6_case_rate  </span></span>
<span><span class="co">#&gt;         -0.006236           0.004849           0.005536          -0.013340  </span></span>
<span><span class="co">#&gt;   lag_7_case_rate   lag_14_case_rate  </span></span>
<span><span class="co">#&gt;          0.011320           0.011674</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Alternatively, we may use the <code><a href="../reference/Add_model.html">Remove_model()</a></code> followed by
<code><a href="../reference/Add_model.html">Add_model()</a></code> combination for the same effect.</p>
</div>
<div class="section level2">
<h2 id="addupdateremove-a-frosting-object-in-an-epi_workflow">Add/update/remove a <code>frosting</code> object in an
<code>epi_workflow</code><a class="anchor" aria-label="anchor" href="#addupdateremove-a-frosting-object-in-an-epi_workflow"></a>
</h2>
<p>We will now generate and create a <code>frosting</code> object for
post-processing predictions. In our initial frosting object,
<code>f</code>, we simply implement predictions on the fitted
<code>epi_workflow</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/frosting.html">frosting</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/layer_predict.html">layer_predict</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf1</span> <span class="op">&lt;-</span> <span class="va">wf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/add_frosting.html">add_frosting</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">wf1</span><span class="op">)</span></span>
<span><span class="va">p1</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4 x 3 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2023-03-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span>   <span style="font-weight: bold;">.pred</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ak        2021-12-31 -<span style="color: #BB0000;">0.206</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2021-12-31  0.099<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ny        2021-12-31  0.295 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sc        2021-12-31  0.351</span></span></code></pre></div>
<p>Suppose we decide to augment our post-processing to include a
threshold to enforce that the predictions are at least 0. As well, let’s
include the forecast and target dates as separate columns.</p>
<p>To update the <code>frosting</code> while leaving the remainder of
the <code>epi_workflow</code> the same, we can use the
<code><a href="../reference/add_frosting.html">update_frosting()</a></code> function as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Update frosting in a workflow and predict</span></span>
<span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/frosting.html">frosting</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/layer_predict.html">layer_predict</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/layer_threshold.html">layer_threshold</a></span><span class="op">(</span><span class="va">.pred</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/layer_add_forecast_date.html">layer_add_forecast_date</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/layer_add_target_date.html">layer_add_target_date</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf2</span> <span class="op">&lt;-</span> <span class="va">wf1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/add_frosting.html">update_frosting</a></span><span class="op">(</span><span class="va">f2</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">wf2</span><span class="op">)</span></span>
<span><span class="va">p2</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4 x 5 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2023-03-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span>  <span style="font-weight: bold;">.pred</span> <span style="font-weight: bold;">forecast_date</span> <span style="font-weight: bold;">target_date</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ak        2021-12-31 0      2021-12-31    2022-01-07 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2021-12-31 0.099<span style="text-decoration: underline;">2</span> 2021-12-31    2022-01-07 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ny        2021-12-31 0.295  2021-12-31    2022-01-07 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sc        2021-12-31 0.351  2021-12-31    2022-01-07</span></span></code></pre></div>
<p>Internally, this works by removing the old frosting followed by
adding the new frosting, just like when we update a recipe or model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">update_frosting</span></span>
<span><span class="co">#&gt; function (x, frosting, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     rlang::check_dots_empty()</span></span>
<span><span class="co">#&gt;     x &lt;- remove_frosting(x)</span></span>
<span><span class="co">#&gt;     add_frosting(x, frosting)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55b0c3532140&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:epipredict&gt;</span></span></code></pre></div>
<p>If we decide that we do not want the <code>frosting</code>
post-processing at all, we can remove the <code>frosting</code> object
from the workflow and make predictions as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf3</span> <span class="op">&lt;-</span> <span class="va">wf2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/add_frosting.html">remove_frosting</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span><span class="va">wf3</span><span class="op">)</span></span>
<span><span class="va">p3</span></span>
<span><span class="co">#&gt; An `epi_df` object, 4 x 3 with metadata:</span></span>
<span><span class="co">#&gt; * geo_type  = state</span></span>
<span><span class="co">#&gt; * time_type = day</span></span>
<span><span class="co">#&gt; * as_of     = 2023-03-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">geo_value</span> <span style="font-weight: bold;">time_value</span>   <span style="font-weight: bold;">.pred</span></span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ak        2021-12-31 -<span style="color: #BB0000;">0.206</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ca        2021-12-31  0.099<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ny        2021-12-31  0.295 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> sc        2021-12-31  0.351</span></span></code></pre></div>
<p>You can see that the above results from <code>p3</code> are the same
as from <code>p1</code>, when we simply have a prediction layer in the
<code>frosting</code> post-processing container.</p>
</div>
<div class="section level2">
<h2 id="adjust-a-single-step-of-an-epi_recipe">Adjust a single step of an <code>epi_recipe</code><a class="anchor" aria-label="anchor" href="#adjust-a-single-step-of-an-epi_recipe"></a>
</h2>
<p>Suppose that we just want to change a single step in an
<code>epi_recipe</code> (that is either standalone or a part of an
<code>epi_workflow</code>). Instead of replacing an entire
<code>epi_recipe</code>, we can use the <code><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe()</a></code>
function. In this function, the step to be adjusted is indicated either
the step number or name in the <code>which_step</code> parameter. Then,
the parameter name and update value must be inputted as
<code>...</code>.</p>
<p>For instance, suppose that we decide to lead the
<code>death_rate</code> by 14 days instead of 7. We may adjust this step
in <code>wf</code> recipe by setting <code>which_step</code> to the step
number in the order of operations, which can be obtained by inspecting
<code>r2</code> or the tidy summary of it:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_preprocessor</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span> <span class="co"># step_epi_ahead is the third step in r2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; raw:        2</span></span>
<span><span class="co">#&gt; geo_value:  1</span></span>
<span><span class="co">#&gt; time_value: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; 1. Lagging: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14</span></span></span>
<span><span class="co">#&gt; 2. Lagging: <span style="color: #0000BB;">case_rate</span> by <span style="color: #0000BB;">0, 1, 2, 3, 4, 5, 6, 7, 14</span></span></span>
<span><span class="co">#&gt; 3. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; 4. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_predictors()</span></span></span>
<span><span class="co">#&gt; 5. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_outcomes()</span></span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_preprocessor</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span><span class="op">)</span> <span class="co"># tidy tibble summary of r2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">number</span> <span style="font-weight: bold;">operation</span> <span style="font-weight: bold;">type</span>      <span style="font-weight: bold;">trained</span> <span style="font-weight: bold;">skip</span>  <span style="font-weight: bold;">id</span>             </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1 step      epi_lag   FALSE   FALSE epi_lag_9QeuR  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2 step      epi_lag   FALSE   FALSE epi_lag_8HfdV  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3 step      epi_ahead FALSE   FALSE epi_ahead_HIyvQ</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      4 step      naomit    FALSE   FALSE naomit_vjF0H   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      5 step      naomit    FALSE   TRUE  naomit_gF0fi</span></span>
<span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="va">wf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe</a></span><span class="op">(</span>which_step <span class="op">=</span> <span class="fl">3</span>, ahead <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we may adjust that step by name by specifying the full
name of the step, <code>step_epi_ahead</code>, in
<code>which_step</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe</a></span><span class="op">(</span>which_step <span class="op">=</span> <span class="st">"step_epi_ahead"</span>, ahead <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="co"># not overwrite r2 because same result</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ Epi Workflow ═════════════════════════════════════════════════════════════</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Preprocessor:</span> Recipe</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Model:</span> linear_reg()</span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">Postprocessor:</span> None</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Preprocessor ─────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 5 Recipe steps.</span></span>
<span><span class="co">#&gt; 1. step_epi_lag()</span></span>
<span><span class="co">#&gt; 2. step_epi_lag()</span></span>
<span><span class="co">#&gt; 3. step_epi_ahead()</span></span>
<span><span class="co">#&gt; 4. step_naomit()</span></span>
<span><span class="co">#&gt; 5. step_naomit()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Model ────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::lm(formula = ..y ~ ., data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;       (Intercept)   lag_0_death_rate   lag_1_death_rate   lag_7_death_rate  </span></span>
<span><span class="co">#&gt;          0.290875          -0.156658           0.054776          -0.348165  </span></span>
<span><span class="co">#&gt; lag_14_death_rate    lag_0_case_rate    lag_1_case_rate    lag_2_case_rate  </span></span>
<span><span class="co">#&gt;         -0.303906           0.009033          -0.009466          -0.005362  </span></span>
<span><span class="co">#&gt;   lag_3_case_rate    lag_4_case_rate    lag_5_case_rate    lag_6_case_rate  </span></span>
<span><span class="co">#&gt;         -0.006236           0.004849           0.005536          -0.013340  </span></span>
<span><span class="co">#&gt;   lag_7_case_rate   lag_14_case_rate  </span></span>
<span><span class="co">#&gt;          0.011320           0.011674</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>If there are at least two steps in a recipe that share the same name,
specifying the name in <code>which_step</code> will throw an error as
<code><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe()</a></code> is not intended to be used to modify
multiple steps at once. The way, then, to modify a step that has the
same name as another is to indicate what number it is in the ordering of
the steps. For example, in <code>r2</code> there are two steps named
<code>step_epi_lag</code> - the first step where we lag the death rate,
and the second where we lag the case rate. If we want to modify the lags
for the <code>case_rate</code> variable, we would specify the step
number of 2 in <code>which_step</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="va">wf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe</a></span><span class="op">(</span>which_step <span class="op">=</span> <span class="fl">2</span>, lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_preprocessor</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; raw:        2</span></span>
<span><span class="co">#&gt; geo_value:  1</span></span>
<span><span class="co">#&gt; time_value: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; 1. Lagging: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14</span></span></span>
<span><span class="co">#&gt; 2. Lagging: <span style="color: #0000BB;">case_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14, 21</span></span></span>
<span><span class="co">#&gt; 3. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">14</span></span></span>
<span><span class="co">#&gt; 4. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_predictors()</span></span></span>
<span><span class="co">#&gt; 5. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_outcomes()</span></span></span></code></pre></div>
<p>We could adjust a recipe directly in the same way as we adjust a
recipe in a workflow. The main difference is that we would not input
<code>wf</code> as the first argument to
<code><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe()</a></code> but rather <code>r2</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe</a></span><span class="op">(</span><span class="va">r2</span>, which_step <span class="op">=</span> <span class="fl">2</span>, lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="co"># should be same result as above</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; raw:        2</span></span>
<span><span class="co">#&gt; geo_value:  1</span></span>
<span><span class="co">#&gt; time_value: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; 1. Lagging: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14</span></span></span>
<span><span class="co">#&gt; 2. Lagging: <span style="color: #0000BB;">case_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14, 21</span></span></span>
<span><span class="co">#&gt; 3. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; 4. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_predictors()</span></span></span>
<span><span class="co">#&gt; 5. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_outcomes()</span></span></span></code></pre></div>
<p>Note that when we adjust the <code>r2</code> object directly, we are
not adjusting the recipe in the <code>epi_workflow</code>. That is, if
we modify a step in <code>r2</code>, the change will not automatically
transfer over to <code>wf</code>. We would need to modify the recipe in
<code>wf</code> directly (<code><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe()</a></code> on
<code>wf</code>) or update the recipe in <code>wf</code> with a new
<code>epi_recipe</code> that has undergone the adjustment (using
<code><a href="../reference/add_epi_recipe.html">update_epi_recipe()</a></code>):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_epi_recipe.html">adjust_epi_recipe</a></span><span class="op">(</span><span class="va">r2</span>, which_step <span class="op">=</span> <span class="fl">2</span>, lag <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">21</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_preprocessor</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; raw:        2</span></span>
<span><span class="co">#&gt; geo_value:  1</span></span>
<span><span class="co">#&gt; time_value: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; 1. Lagging: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14</span></span></span>
<span><span class="co">#&gt; 2. Lagging: <span style="color: #0000BB;">case_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14, 21</span></span></span>
<span><span class="co">#&gt; 3. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">14</span></span></span>
<span><span class="co">#&gt; 4. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_predictors()</span></span></span>
<span><span class="co">#&gt; 5. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_outcomes()</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjust-a-single-layer-of-a-frosting">Adjust a single layer of a <code>frosting</code><a class="anchor" aria-label="anchor" href="#adjust-a-single-layer-of-a-frosting"></a>
</h2>
<p>Adjusting a layer of a <code>frosting</code> object proceeds in the
same way as adjusting a step in an <code>epi_recipe</code> does. So if
we want to change a single layer in a <code>frosting</code> (that is
either in a standalone object or part of an <code>epi_workflow</code>),
we can use the <code><a href="../reference/adjust_frosting.html">adjust_frosting()</a></code> function wherein the layer
to be adjusted is indicated by either its number or name in the
<code>which_layer</code> parameter. In addition, the argument name and
update value must be inputted as <code>...</code>.</p>
<p>Let’s work with the frosting object directly instead of working on it
through the <code>epi_workflow</code> in a simple, illustrative example.
Recall frosting <code>f2</code> which has the following layers:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Frosting</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Layers</span></span>
<span><span class="co">#&gt; 1. Creating predictions: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span><span class="co">#&gt; 2. Thresholding predictions: <span style="color: #0000BB;">.pred</span> to <span style="color: #0000BB;">[0, Inf)</span></span></span>
<span><span class="co">#&gt; 3. Adding forecast date: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span><span class="co">#&gt; 4. Adding target date: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span></code></pre></div>
<p>Suppose that we decide to change the upper bound of the prediction
threshold to 10 instead of <code>Inf</code>. We can adjust this layer in
frosting object by setting <code>which_layer</code> to the layer number,
3 (which can be found by inspecting <code>f2</code> or
<code>tidy(f2)</code>):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="va">f2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/adjust_frosting.html">adjust_frosting</a></span><span class="op">(</span>which_layer <span class="op">=</span> <span class="fl">2</span>, upper <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Frosting</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Layers</span></span>
<span><span class="co">#&gt; 1. Creating predictions: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span><span class="co">#&gt; 2. Thresholding predictions: <span style="color: #0000BB;">.pred</span> to <span style="color: #0000BB;">[0, 10]</span></span></span>
<span><span class="co">#&gt; 3. Adding forecast date: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span><span class="co">#&gt; 4. Adding target date: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span></code></pre></div>
<p>Alternatively, we may adjust that layer by specifying its full name,
<code>layer_threshold</code>, in <code>which_layer</code>, to achieve
the same result:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/adjust_frosting.html">adjust_frosting</a></span><span class="op">(</span>which_layer <span class="op">=</span> <span class="st">"layer_threshold"</span>, upper <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># not overwrite f2 because same result</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Frosting</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Layers</span></span>
<span><span class="co">#&gt; 1. Creating predictions: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span><span class="co">#&gt; 2. Thresholding predictions: <span style="color: #0000BB;">.pred</span> to <span style="color: #0000BB;">[0, 10]</span></span></span>
<span><span class="co">#&gt; 3. Adding forecast date: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span><span class="co">#&gt; 4. Adding target date: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="on-the-tidy-method-to-inspect-an-epi_recipe-or-a-frosting-object">On the tidy method to inspect an <code>epi_recipe</code> or a
<code>frosting</code> object<a class="anchor" aria-label="anchor" href="#on-the-tidy-method-to-inspect-an-epi_recipe-or-a-frosting-object"></a>
</h2>
<p>The tidy method, when used on an <code>epi_recipe</code>, will return
a data frame that contains specific overview information about the
recipe including the operation number, the operation class (either
“step” or “check”), the type of method, a boolean value to indicate
whether <code><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep()</a></code> has been used to estimate the operation, a
boolean value to indicate whether the step is applied when
<code><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake()</a></code> is called, and the id of the operation.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">number</span> <span style="font-weight: bold;">operation</span> <span style="font-weight: bold;">type</span>      <span style="font-weight: bold;">trained</span> <span style="font-weight: bold;">skip</span>  <span style="font-weight: bold;">id</span>             </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1 step      epi_lag   FALSE   FALSE epi_lag_9QeuR  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2 step      epi_lag   FALSE   FALSE epi_lag_8HfdV  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3 step      epi_ahead FALSE   FALSE epi_ahead_HIyvQ</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      4 step      naomit    FALSE   FALSE naomit_vjF0H   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      5 step      naomit    FALSE   TRUE  naomit_gF0fi</span></span></code></pre></div>
<p>In contrast, printing the <code>epi_recipe</code> object shows the
inputs (number and roles of the variables) as well as the ordering and a
brief written summary of the operations:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Epi Recipe</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Inputs</span></span>
<span><span class="co">#&gt; Number of variables by role</span></span>
<span><span class="co">#&gt; raw:        2</span></span>
<span><span class="co">#&gt; geo_value:  1</span></span>
<span><span class="co">#&gt; time_value: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Operations</span></span>
<span><span class="co">#&gt; 1. Lagging: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">0, 1, 7, 14</span></span></span>
<span><span class="co">#&gt; 2. Lagging: <span style="color: #0000BB;">case_rate</span> by <span style="color: #0000BB;">0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,</span></span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">15,</span></span></span>
<span><span class="co">#&gt; 3. <span style="color: #0000BB;">16, 17, 18,...</span></span></span>
<span><span class="co">#&gt; 4. Leading: <span style="color: #0000BB;">death_rate</span> by <span style="color: #0000BB;">7</span></span></span>
<span><span class="co">#&gt; 5. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_predictors()</span></span></span>
<span><span class="co">#&gt; 6. <span style="color: #00BBBB;">•</span> Removing rows with NA values in: <span style="color: #0000BB;">all_outcomes()</span></span></span></code></pre></div>
<p>This same general structure persists when we compare the output of a
frosting object to that of its tidy tibble. However, we no longer have
the output specific to a recipe such as the roles in the recipe output
and the trained and skip columns in tidy tibble for it. Thus, the output
of a frosting object and the tidy tibble are simplified in comparison to
those for an <code>epi_recipe</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Frosting</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Layers</span></span>
<span><span class="co">#&gt; 1. Creating predictions: <span style="color: #0000BB;">"&lt;calculated&gt;"</span></span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   <span style="font-weight: bold;">number</span> <span style="font-weight: bold;">operation</span> <span style="font-weight: bold;">type</span>    <span style="font-weight: bold;">id</span>                   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1 layer     predict predict_default_qZ3vE</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><a href="https://delphi.cmu.edu/about/" class="external-link">About Delphi</a> • <a href="https://delphi.cmu.edu/epidemic-signals/terms-of-use/" class="external-link">Terms of Use</a> • <a href="https://docs.google.com/forms/u/1/d/e/1FAIpQLScqgT1fKZr5VWBfsaSp-DNaN03aV6EoZU4YljIzHJ1Wl_zmtg/viewform" class="external-link">Contact Us</a> • <a href="https://github.com/cmu-delphi/" class="external-link">Delphi GitHub</a> • <a href="https://cmu-delphi.github.io/delphi-epidata/" class="external-link">Epidata API</a></p>
</div>

<div class="pkgdown-footer-right">
  <p>epipredict</p>
</div>

    </footer>
</div>





  </body>
</html>
