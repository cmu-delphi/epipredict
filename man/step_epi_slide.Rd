% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/step_epi_slide.R
\name{step_epi_slide}
\alias{step_epi_slide}
\title{Calculate a rolling window transformation}
\usage{
step_epi_slide(
  recipe,
  ...,
  .f,
  .window_size = NULL,
  .align = c("right", "center", "left"),
  role = "predictor",
  prefix = "epi_slide_",
  f_name = clean_f_name(.f),
  skip = FALSE,
  id = rand_id("epi_slide")
)
}
\arguments{
\item{recipe}{A recipe object. The step will be added to the
sequence of operations for this recipe.}

\item{...}{One or more selector functions to choose variables
for this step. See \code{\link[recipes:selections]{recipes::selections()}} for more details.}

\item{.f}{A function in one of the following formats:
\enumerate{
\item An unquoted function name with no arguments, e.g., \code{mean}
\item A character string name of a function, e.g., \code{"mean"}. Note that this
can be difficult to examine for mistakes (so the misspelling \code{"maen"}
won't produce an error until you try to actually fit the model)
\item A base \code{R} lambda function, e.g., \code{function(x) mean(x, na.rm = TRUE)}
\item A new-style base \code{R} lambda function, e.g., \verb{\\(x) mean(x, na.rm = TRUE)}
\item A one-sided formula like \code{~ mean(.x, na.rm = TRUE)}.
}

Note that in cases 3 and 4, \code{x} can be any variable name you like (for
example \verb{\\(dog) mean(dog, na.rm = TRUE)} will work). But in case 5, the
argument must be named \code{.x}. A common, though very difficult to debug
error is using something like \code{function(x) mean}. This will not work
because it returns the function mean, rather than \code{mean(x)}}

\item{.window_size}{the size of the sliding window, required. Usually a
non-negative integer will suffice (e.g. for data indexed by date, but more
restrictive in other time_type cases (see \code{\link[epiprocess:epi_slide]{epiprocess::epi_slide()}} for
details). For example, set to 7 for a 7-day window.}

\item{.align}{a character string indicating how the window should be aligned.
By default, this is "right", meaning the slide_window will be anchored with
its right end point on the reference date. (see \code{\link[epiprocess:epi_slide]{epiprocess::epi_slide()}}
for details).}

\item{role}{For model terms created by this step, what analysis role should
they be assigned? \code{lag} is default a predictor while \code{ahead} is an outcome.}

\item{prefix}{A character string that will be prefixed to the new column.}

\item{f_name}{a character string of at most 20 characters that describes the
function. This will be combined with \code{prefix} and the columns in \code{...} to
name the result using \verb{\{prefix\}\{f_name\}_\{column\}}. By default it will be
determined automatically using \code{clean_f_name()}.}

\item{skip}{A logical. Should the step be skipped when the
recipe is baked by \code{\link[=bake]{bake()}}? While all operations are baked
when \code{\link[=prep]{prep()}} is run, some operations may not be able to be
conducted on new data (e.g. processing the outcome variable(s)).
Care should be taken when using \code{skip = TRUE} as it may affect
the computations for subsequent operations.}

\item{id}{A unique identifier for the step}
}
\value{
An updated version of \code{recipe} with the new step added to the
sequence of any existing operations.
}
\description{
\code{step_epi_slide()} creates a \emph{specification} of a recipe step that will
generate one or more new columns of derived data by "sliding" a computation
along existing data. This is a wrapper around \code{epiprocess::epi_slide()}
to allow its use within an \code{epi_recipe()}.
}
\examples{
jhu <- covid_case_death_rates \%>\%
  filter(time_value >= as.Date("2021-01-01"), geo_value \%in\% c("ca", "ny"))
rec <- epi_recipe(jhu) \%>\%
  step_epi_slide(case_rate, death_rate,
    .f = \(x) mean(x, na.rm = TRUE),
    .window_size = 7L
  )
bake(prep(rec, jhu), new_data = NULL)
}
